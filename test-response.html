<!DOCTYPE html>
<html>
<head>
    <title>Test Video Upload Response</title>
</head>
<body>
    <h2>Upload Video to See Response Structure</h2>
    <input type="file" id="fileInput" accept="video/*">
    <button onclick="uploadVideo()">Upload and Analyze</button>
    <pre id="output" style="background: #f4f4f4; padding: 20px; margin-top: 20px; max-height: 600px; overflow: auto;"></pre>
    
    <script>
    async function uploadVideo() {
        const fileInput = document.getElementById('fileInput');
        const output = document.getElementById('output');
        
        if (!fileInput.files[0]) {
            alert('Please select a video file');
            return;
        }
        
        const formData = new FormData();
        formData.append('video', fileInput.files[0]);
        
        output.textContent = 'Uploading and analyzing...';
        
        try {
            const response = await fetch('http://localhost:5001/api/videos/upload', {
                method: 'POST',
                body: formData
            });
            
            const responseText = await response.text();
            
            // 显示原始响应
            output.textContent = '=== RAW RESPONSE ===\n' + responseText + '\n\n';
            
            try {
                const data = JSON.parse(responseText);
                
                // 显示解析后的结构
                output.textContent += '=== PARSED JSON STRUCTURE ===\n';
                output.textContent += JSON.stringify(data, null, 2) + '\n\n';
                
                // 显示分析结果的具体内容
                if (data.analysisResult && data.analysisResult.full_analysis) {
                    output.textContent += '=== FULL ANALYSIS CONTENT ===\n';
                    output.textContent += data.analysisResult.full_analysis + '\n\n';
                    
                    // 尝试解析full_analysis如果是JSON字符串
                    try {
                        const cleanJson = data.analysisResult.full_analysis
                            .replace(/^```json\s*/, '')
                            .replace(/\s*```$/, '')
                            .trim();
                        const analysisJson = JSON.parse(cleanJson);
                        output.textContent += '=== PARSED ANALYSIS JSON ===\n';
                        output.textContent += JSON.stringify(analysisJson, null, 2);
                    } catch (e) {
                        output.textContent += '=== ANALYSIS IS NOT JSON ===\n';
                        output.textContent += 'Parse error: ' + e.message;
                    }
                }
            } catch (e) {
                output.textContent += '\n=== JSON PARSE ERROR ===\n' + e.message;
            }
        } catch (error) {
            output.textContent = 'Network error: ' + error.message;
        }
    }
    </script>
</body>
</html>